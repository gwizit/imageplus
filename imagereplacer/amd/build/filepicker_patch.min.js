define("local_imagereplacer/filepicker_patch",["core/yui"],(function(Y){"use strict";return{init:function(){if(!window.M||!M.core_filepicker||!M.core_filepicker.prototype)return;var e=M.core_filepicker.prototype;if(e.__imagereplacer_patched)return;var r=e.setup_toolbar;e.setup_toolbar=function(){var e=this.filemanager;if(!e)return r.apply(this,arguments);if(e=e.one?e:Y.one(e),!e)return r.apply(this,arguments);var t=e.one(".fp-content");t||(t=e);var o=t.one(".fp-toolbar");if(!o){o=Y.Node.create('<div class="fp-toolbar"></div>');var n=Y.Node.create('<div class="fp-tb-search"></div>'),a=Y.Node.create('<div class="fp-tb-buttons"></div>');o.append(n),o.append(a),t.prepend(o)}if(this.filemanager=e,this.toolbar=o)try{return r.apply(this,arguments)}catch(c){window.console&&console.warn&&console.warn("Filepicker toolbar patch caught error",c)}},function(){var r=e.display_response;e.display_response=function(e){try{return r.call(this,e)}catch(t){if(t&&t.message&&-1!==t.message.indexOf("activenode"))return this.activeview=null,r.call(this,e);throw t}}}(),e.__imagereplacer_patched=!0}}}));